import{d as v,ai as E,o as e,e as a,a as n,r as H,b as r,w as s,t as C,g as c,a0 as P,i as L,n as w,D as N,K as D,T as I,E as O,M as Q,c as h,f as l,h as U,u as z,F as G,j as J,O as K}from"./app-1cf49233.js";import{b as W,a as X}from"./DialogModal-85452bfd.js";import{_ as V}from"./PrimaryButton-0796906c.js";import{_ as S}from"./SecondaryButton-4066f329.js";import{_ as B}from"./TextInput-97b9c743.js";import{_ as Y}from"./DangerButton-4933c7d6.js";import"./SectionTitle-f4e0473f.js";const Z={class:"dark:text-gray-50"},ee={class:"mt-4"},y={__name:"ConfirmsPassword",props:{title:{type:String,default:"Confirmer le mot de passe"},content:{type:String,default:"Pour des raisons de sécurité, veuillez confirmer votre mot de passe pour continuer."},button:{type:String,default:"Confirmer"}},emits:["confirmed"],setup(g,{emit:k}){const x=v(!1),t=E({password:"",error:"",processing:!1}),o=v(null),f=()=>{axios.get(route("password.confirmation")).then(i=>{i.data.confirmed?k("confirmed"):(x.value=!0,setTimeout(()=>o.value.focus(),250))})},_=()=>{t.processing=!0,axios.post(route("password.confirm"),{password:t.password}).then(()=>{t.processing=!1,m(),N().then(()=>k("confirmed"))}).catch(i=>{t.processing=!1,t.error=i.response.data.errors.password[0],o.value.focus()})},m=()=>{x.value=!1,t.password="",t.error=""};return(i,u)=>(e(),a("span",null,[n("span",{onClick:f},[H(i.$slots,"default")]),r(W,{show:x.value,onClose:m},{title:s(()=>[n("p",Z,C(g.title),1)]),content:s(()=>[c(C(g.content)+" ",1),n("div",ee,[r(B,{ref_key:"passwordInput",ref:o,modelValue:t.password,"onUpdate:modelValue":u[0]||(u[0]=p=>t.password=p),type:"password",class:"block w-3/4 mt-1",placeholder:"Password",autocomplete:"current-password",onKeyup:P(_,["enter"])},null,8,["modelValue","onKeyup"]),r(L,{message:t.error,class:"mt-2"},null,8,["message"])])]),footer:s(()=>[r(S,{onClick:m},{default:s(()=>[c(" Annuler ")]),_:1}),r(V,{class:w(["ml-3",{"opacity-25":t.processing}]),disabled:t.processing,onClick:_},{default:s(()=>[c(C(g.button),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"])]))}},te=n("h1",{class:"dark:text-gray-50"}," L'authentification à deux facteurs ",-1),se=n("p",{class:"dark:text-gray-50"}," Ajoutez une sécurité supplémentaire à votre compte en utilisant l'authentification à deux facteurs.",-1),oe={key:0,class:"text-lg font-medium text-gray-900 dark:text-white"},ae={key:1,class:"text-lg font-medium text-gray-900 dark:text-gray-50"},re={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-50"},ne=n("div",{class:"max-w-xl mt-3 text-sm text-gray-600 dark:text-gray-50"},[n("p",null," Lorsque l'authentification à deux facteurs est activée, vous serez invité à saisir un jeton aléatoire sécurisé lors de l'authentification. Vous pouvez récupérer ce jeton depuis l'application Google Authenticator de votre téléphone. ")],-1),ie={key:3},le={key:0},ce={class:"max-w-xl mt-4 text-sm text-gray-600 dark:text-gray-200"},ue={key:0,class:"font-semibold"},de={key:1},fe=["innerHTML"],me={key:0,class:"max-w-xl mt-4 text-sm text-gray-600"},pe={class:"font-semibold"},ve=["innerHTML"],_e={key:1,class:"mt-4"},he={key:1},ye=n("div",{class:"max-w-xl mt-4 text-sm text-gray-600 dark:text-gray-200"},[n("p",{class:"font-semibold"}," Stockez ces codes de récupération dans un gestionnaire de mots de passe sécurisé. Ils peuvent être utilisés pour récupérer l'accès à votre compte si votre appareil d'authentification à deux facteurs est perdu. ")],-1),ge={class:"grid max-w-xl gap-1 px-4 py-4 mt-4 font-mono text-sm bg-gray-100 rounded-lg dark:bg-gray-800"},xe={class:"mt-5"},we={key:0},ke={key:1},Ae={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(g){const k=g,x=D(),t=v(!1),o=v(!1),f=v(!1),_=v(null),m=v(null),i=v([]),u=I({code:""}),p=O(()=>{var d;return!t.value&&((d=x.props.auth.user)==null?void 0:d.two_factor_enabled)});Q(p,()=>{p.value||(u.reset(),u.clearErrors())});const M=()=>{t.value=!0,K.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>Promise.all([q(),R(),T()]),onFinish:()=>{t.value=!1,o.value=k.requiresConfirmation}})},q=()=>axios.get(route("two-factor.qr-code")).then(d=>{_.value=d.data.svg}),R=()=>axios.get(route("two-factor.secret-key")).then(d=>{m.value=d.data.secretKey}),T=()=>axios.get(route("two-factor.recovery-codes")).then(d=>{i.value=d.data}),$=()=>{u.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{o.value=!1,_.value=null,m.value=null}})},j=()=>{axios.post(route("two-factor.recovery-codes")).then(()=>T())},A=()=>{f.value=!0,K.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{f.value=!1,o.value=!1}})};return(d,F)=>(e(),h(X,null,{title:s(()=>[te]),description:s(()=>[se]),content:s(()=>[p.value&&!o.value?(e(),a("h3",oe," Vous avez activé l'authentification à deux facteurs. ")):p.value&&o.value?(e(),a("h3",ae," Terminer l'activation de l'authentification à deux facteurs.. ")):(e(),a("h3",re," Vous n'avez pas activé l'authentification à deux facteurs. ")),ne,p.value?(e(),a("div",ie,[_.value?(e(),a("div",le,[n("div",ce,[o.value?(e(),a("p",ue," Pour finaliser l'activation de l'authentification à deux facteurs, scannez le code QR suivant en utilisant l'application d'authentification de votre téléphone ou saisissez la clé de configuration et fournissez le code OTP généré. ")):(e(),a("p",de," L'authentification à deux facteurs est désormais activée. Scannez le code QR suivant en utilisant l'application d'authentification de votre téléphone ou saisissez la clé de configuration. "))]),n("div",{class:"inline-block p-2 mt-4 bg-white",innerHTML:_.value},null,8,fe),m.value?(e(),a("div",me,[n("p",pe,[c(" Setup Key: "),n("span",{innerHTML:m.value},null,8,ve)])])):l("",!0),o.value?(e(),a("div",_e,[r(U,{for:"code",value:"Code"}),r(B,{id:"code",modelValue:z(u).code,"onUpdate:modelValue":F[0]||(F[0]=b=>z(u).code=b),type:"text",name:"code",class:"block w-1/2 mt-1",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:P($,["enter"])},null,8,["modelValue","onKeyup"]),r(L,{message:z(u).errors.code,class:"mt-2"},null,8,["message"])])):l("",!0)])):l("",!0),i.value.length>0&&!o.value?(e(),a("div",he,[ye,n("div",ge,[(e(!0),a(G,null,J(i.value,b=>(e(),a("div",{key:b},C(b),1))),128))])])):l("",!0)])):l("",!0),n("div",xe,[p.value?(e(),a("div",ke,[r(y,{onConfirmed:$},{default:s(()=>[o.value?(e(),h(V,{key:0,type:"button",class:w(["mr-3",{"opacity-25":t.value}]),disabled:t.value},{default:s(()=>[c(" Confirm ")]),_:1},8,["class","disabled"])):l("",!0)]),_:1}),r(y,{onConfirmed:j},{default:s(()=>[i.value.length>0&&!o.value?(e(),h(S,{key:0,class:"mr-3"},{default:s(()=>[c(" Régénérer les codes de récupération ")]),_:1})):l("",!0)]),_:1}),r(y,{onConfirmed:T},{default:s(()=>[i.value.length===0&&!o.value?(e(),h(S,{key:0,class:"mr-3"},{default:s(()=>[c(" Afficher les codes de récupération ")]),_:1})):l("",!0)]),_:1}),r(y,{onConfirmed:A},{default:s(()=>[o.value?(e(),h(S,{key:0,class:w({"opacity-25":f.value}),disabled:f.value},{default:s(()=>[c(" Annuler ")]),_:1},8,["class","disabled"])):l("",!0)]),_:1}),r(y,{onConfirmed:A},{default:s(()=>[o.value?l("",!0):(e(),h(Y,{key:0,class:w({"opacity-25":f.value}),disabled:f.value},{default:s(()=>[c(" Desactiver ")]),_:1},8,["class","disabled"]))]),_:1})])):(e(),a("div",we,[r(y,{onConfirmed:M},{default:s(()=>[r(V,{type:"button",class:w({"opacity-25":t.value}),disabled:t.value},{default:s(()=>[c(" Activer ")]),_:1},8,["class","disabled"])]),_:1})]))])]),_:1}))}};export{Ae as default};
